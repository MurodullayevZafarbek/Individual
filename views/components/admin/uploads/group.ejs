<style>
    #blokingStatus,
    #statusDATE {
        display: none;
    }
</style>

<div class="row">
    <div class="col-12">

        <div class="row">
            <div class="col-12">
                <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                    <h3 class="mb-sm-0">Guruhlar bo'limi</h3>

                    <div class="page-title-right">
                        <ol class="breadcrumb m-0">
                            <li class="breadcrumb-item"><a href="/manager/dashboard/general">Asosiy sahifa</a></li>
                            <li class="breadcrumb-item active">Guruhlar</li>
                        </ol>
                    </div>

                </div>
            </div>
        </div>

        <div class="row col md-12 d-flex justify-content-between align-items-center">
            <div class="col-md-9">
                <button class="btn btn-primary " type="button" data-bs-toggle="offcanvas"
                    data-bs-target="#CREATE_CANVAS" aria-controls="CREATE_CANVAS">
                    <i class="far fa-plus-square"></i>
                    Qo'shish
                </button>
            </div>

            <div class="col-md-3">
                <select class="select2 form-control" onchange="filterSchool(this.value)" id="filterBySchool"></select>
            </div>
        </div>


        <div class="card mt-3">
            <div class="card-body">
                <table class="table table-striped table-bordered dt-responsive
                    nowrap text-center" style="border-collapse: collapse; border-spacing: 0; width:
                    100%">
                    <thead>
                        <tr>
                            <th style="width: 40%;">Guruh nomi</th>
                            <th style="width: 20%;">Narxi</th>
                            <th style="width: 15%;">Status holati</th>
                            <th style="width: 15%;">Yaratilgan sana</th>
                            <th style="width: 10%;">Sozlama</th>
                        </tr>
                    </thead>

                    <tbody class="put_tables"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="offcanvas offcanvas-end" style="width: 50%" tabindex="-1" id="CREATE_CANVAS"
    aria-labelledby="CREATE_CANVAS_LABEL">
    <div class="offcanvas-header">
        <h5 class="font-size-22 mt-3 p-2 badge bg-dark">Yangi guruh yaratish</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">

        <!-- O'quv markazi -->
        <label class="form-label">Filiallar nomi</label>
        <select class="form-control select2" onchange="FILTER_SCHOOL(this.value)" id="school_all"></select>
        <!-- O'quv markazning kategoriyasi -->
        <label class="form-label mt-2">Kategoriya nomi</label>
        <select class="form-control select2" onchange="FILTER_CATEGORY(this.value)" id="category_all"></select>
        <!-- Qaysi kurs uchun ochilgan ushbu guruh -->
        <label class="form-label mt-2">Kurs nomi</label>
        <select class="form-control select2" id="speciality_all"></select>
        <!-- O'quv markazning xonasi -->
        <label class="form-label mt-2">Xona nomi</label>
        <select class="form-control select2" id="room_all"></select>
        <!-- Guruh nomi -->
        <label class=" mt-2">Guruh nomi</label>
        <input type="text" class="form-control" id="name" />
        <!-- Rang nomi -->
        <label class=" mt-2">Guruh uchun rang tanlang</label>
        <input type="color" class="form-control" id="color" />
        <!-- Guruh to'lovi -->
        <div class="mb-2">
            <label class="form-label" for="input-repeat">Guruhning oylik to'lovi</label>
            <input id="input-repeat" class="form-control input-mask"
                data-inputmask="'mask': '9', 'repeat': 10, 'greedy' : false">
        </div>
        <!-- Guruhning ochilgan va yakunlanadigan sanasi -->
        <div class="mt-2">
            <label class="form-label">Guruhning ochiladigan va tugaydigan vaqti</label>
            <div class="input-daterange input-group" id="datepicker6" data-date-format="dd M, yyyy"
                data-date-autoclose="true" data-provide="datepicker" data-date-container="#datepicker6">
                <input type="text" class="form-control" id="startDate" placeholder="Boshlang'ich sana" />
                <input type="text" class="form-control" id="endDate" placeholder="Yankuniy sana" />
            </div>
        </div>
        <!-- Guruhda darsning boshlanish vaqti -->
        <div class="mt-2">
            <label class="form-label">Dars boshlanadigan vaqti</label>
            <select class="form-control select2" id="group_start_hour">
                <option value="" selected>Tanlash</option>

                <option value="07:00">07:00</option>
                <option value="07:30">07:30</option>
                <option value="08:00">08:00</option>
                <option value="08:30">08:30</option>
                <option value="09:00">09:00</option>
                <option value="09:30">09:30</option>
                <option value="10:00">10:00</option>
                <option value="10:30">10:30</option>
                <option value="11:00">11:00</option>
                <option value="11:30">11:30</option>
                <option value="12:00">12:00</option>
                <option value="12:30">12:30</option>
                <option value="13:00">13:00</option>
                <option value="13:30">13:30</option>
                <option value="14:00">14:00</option>
                <option value="14:30">14:30</option>
                <option value="15:00">15:00</option>
                <option value="15:30">15:30</option>
                <option value="16:00">16:00</option>
                <option value="16:30">16:30</option>
                <option value="17:00">17:00</option>
                <option value="17:30">17:30</option>
                <option value="18:00">18:00</option>
                <option value="18:30">18:30</option>
                <option value="19:00">19:00</option>
                <option value="19:30">19:30</option>
                <option value="20:00">20:00</option>
                <option value="20:30">20:30</option>
                <option value="21:00">21:00</option>
                <option value="21:30">21:30</option>
                <option value="22:00">22:00</option>
                <option value="22:30">22:30</option>
                <option value="23:00">23:00</option>
                <option value="23:30">23:30</option>
                <option value="00:00">00:00</option>

            </select>
        </div>
        <!-- Guruhda darsning yakunlanish vaqti -->
        <div class="mt-2">
            <label class="form-label">Dars yakunlanadigan vaqti</label>
            <select class="form-control select2" id="group_end_hour">
                <option value="" selected>Tanlash</option>

                <option value="07:00">07:00</option>
                <option value="07:30">07:30</option>
                <option value="08:00">08:00</option>
                <option value="08:30">08:30</option>
                <option value="09:00">09:00</option>
                <option value="09:30">09:30</option>
                <option value="10:00">10:00</option>
                <option value="10:30">10:30</option>
                <option value="11:00">11:00</option>
                <option value="11:30">11:30</option>
                <option value="12:00">12:00</option>
                <option value="12:30">12:30</option>
                <option value="13:00">13:00</option>
                <option value="13:30">13:30</option>
                <option value="14:00">14:00</option>
                <option value="14:30">14:30</option>
                <option value="15:00">15:00</option>
                <option value="15:30">15:30</option>
                <option value="16:00">16:00</option>
                <option value="16:30">16:30</option>
                <option value="17:00">17:00</option>
                <option value="17:30">17:30</option>
                <option value="18:00">18:00</option>
                <option value="18:30">18:30</option>
                <option value="19:00">19:00</option>
                <option value="19:30">19:30</option>
                <option value="20:00">20:00</option>
                <option value="20:30">20:30</option>
                <option value="21:00">21:00</option>
                <option value="21:30">21:30</option>
                <option value="22:00">22:00</option>
                <option value="22:30">22:30</option>
                <option value="23:00">23:00</option>
                <option value="23:30">23:30</option>
                <option value="00:00">00:00</option>

            </select>
        </div>
        <!-- Guruhda dars davomiyligi -->
        <div class="mt-2">
            <label class="form-label">Dars davomiyligi</label>
            <select class="form-control select2" id="group_lesson_duration">
                <option value="" selected>Tanlash</option>
                <option value="1:00">1 soat</option>
                <option value="1:30">1 soat 30 daqiqa</option>
                <option value="2:00">2 soat</option>
                <option value="2:30">2 soat 30 daqiqa</option>
                <option value="3:00">3 soat</option>
                <option value="3:30">3 soat 30 daqiqa</option>
                <option value="4:00">4 soat</option>
                <option value="4:30">4 soat 30 daqiqa</option>
                <option value="5:00">5 soat</option>
            </select>
        </div>
        <!-- Hafta kunlari -->
        <div class="mt-2">
            <label class="form-label">Hafta kunlari</label>
            <select class="select2 form-control select2-multiple" multiple="multiple" id="group_week">
                <option value="1">Dushanba</option>
                <option value="2">Seshanba</option>
                <option value="3">Chorshanba</option>
                <option value="4">Payshanba</option>
                <option value="5">Juma</option>
                <option value="6">Shanba</option>
                <option value="7">Yakshanba</option>
            </select>
        </div>
        <!-- Guruh holati -->
        <div class="mt-2">
            <label class="form-label">Status holati</label>
            <select onchange="changeStatus(this.value)" class="form-control select2" id="group_status">
                <option value="" selected>Tanlash</option>
                <option value="none">Ochiq holatda</option>
                <option value="forever">Butunlay bloklash</option>
                <option value="pending">Vaqtinchalik bloklash</option>
            </select>
        </div>
        <div class="mt-2" id="blokingStatus">
            <label class="form-label">Vaqtinchalik bloklanish sanalari</label>
            <div class="input-daterange input-group" id="datepicker6" data-date-format="dd M, yyyy"
                data-date-autoclose="true" data-provide="datepicker" data-date-container="#datepicker6">
                <input type="text" class="form-control" id="blocking_start_date" placeholder="Boshlang'ich sana" />
                <input type="text" class="form-control" id="blocking_end_date" placeholder="Yankuniy sana" />
            </div>
        </div>
        <button type="button" onclick="create()" class="btn btn-success waves-effect waves-light mt-2"> Yaratish
        </button>
    </div>
</div>
<div class="offcanvas offcanvas-end" style="width: 50%" tabindex="-1" id="UPDATE_CANVAS"
    aria-labelledby="UPDATE_CANVAS_LABEL">
    <div class="offcanvas-header">
        <h5 class="font-size-22 mt-3 p-2 badge bg-dark">Guruhni tahrirlash</h5>s
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body get_canvas">


        <div class="card border-2">
            <div class="card-body">
                <div class="col-md-12">
                    <label class="form-label">Filiallar nomi</label>
                    <select class="form-control select2" onchange="UPDATE_FILTER_SCHOOL(this.value)"
                        id="update_school_alls"></select>
                    <label class="form-label mt-2">Kategoriya nomi</label>
                    <select class="form-control select2" onchange="UPDATE_FILTER_CATEGORY(this.value)"
                        id="update_category_alls"></select>
                    <label class="form-label mt-2">Kurs nomi</label>
                    <select class="form-control select2" id="update_speciality_alls"></select>
                    <label class="form-label mt-2">Xona nomi</label>
                    <select class="form-control select2" id="update_room_alls"></select>
                    <div class="update_1"> </div>

                </div>
            </div>
        </div>
        <hr>
        <div class="card border-2">
            <div class="card-body">
                <div class="col-md-12">
                    <label class="card-text">Guruh nomi</label>
                    <input type="text" class="form-control" id="group_update_name" />
                    <label class="card-text mt-2">Guruh to'lovi</label>
                    <input type="text" class="form-control" id="group_update_payment" />
                    <div class="update_2"> </div>
                </div>
            </div>
        </div>
        <hr />
        <div class="card border-2">
            <div class="card-body">
                <div class="col-md-12">
                    <label class="card-text">Guruh rangi</label>
                    <input type="color" class="form-control" id="group_update_color">
                    <div class="update_3"> </div>
                </div>
            </div>
        </div>
        <hr />
        <div class="card border-2">
            <div class="card-body">
                <div class="col-md-12">
                    <div class="mt-2">
                        <label class="form-label">Dars boshlanadigan vaqti</label>
                        <select id="update_group_started" class="form-control select2">
                            <option value="" selected>Tanlash</option>
                            <option value="09:00">09:00</option>
                            <option value="10:00">10:00</option>
                            <option value="11:00">11:00</option>
                            <option value="12:00">12:00</option>
                            <option value="13:00">13:00</option>
                            <option value="14:00">14:00</option>
                            <option value="15:00">15:00</option>
                            <option value="16:00">16:00</option>
                            <option value="17:00">17:00</option>
                            <option value="18:00">18:00</option>
                            <option value="19:00">19:00</option>
                            <option value="20:00">20:00</option>
                            <option value="21:00">21:00</option>
                            <option value="22:00">22:00</option>
                            <option value="23:00">23:00</option>
                            <option value="24:00">24:00</option>
                        </select>
                    </div>
                    <div class="mt-2">
                        <label class="form-label">Dars yakunlanadigan vaqti</label>
                        <select id="update_group_ended" class="form-control select2">
                            <option value="" selected>Tanlash</option>
                            <option value="09:00">09:00</option>
                            <option value="10:00">10:00</option>
                            <option value="11:00">11:00</option>
                            <option value="12:00">12:00</option>
                            <option value="13:00">13:00</option>
                            <option value="14:00">14:00</option>
                            <option value="15:00">15:00</option>
                            <option value="16:00">16:00</option>
                            <option value="17:00">17:00</option>
                            <option value="18:00">18:00</option>
                            <option value="19:00">19:00</option>
                            <option value="20:00">20:00</option>
                            <option value="21:00">21:00</option>
                            <option value="22:00">22:00</option>
                            <option value="23:00">23:00</option>
                            <option value="24:00">24:00</option>
                        </select>
                    </div>
                    <div class="mt-2">
                        <label class="form-label">Dars davomiyligi</label>
                        <select id="update_group_houres" class="form-control select2">
                            <option value="" selected>Tanlash</option>
                            <option value="1">1 soat</option>
                            <option value="2">2 soat</option>
                            <option value="3">3 soat</option>
                        </select>
                    </div>
                    <div class="update_4"> </div>
                </div>
            </div>
        </div>
        <hr />
        <div class="card border-2">
            <div class="card-body">
                <div class="mt-2">
                    <label class="form-label">Hafta kunlari</label>
                    <select class="select2 form-control select2-multiple" id="update_group_weeks" multiple="multiple">
                        <option value="1">Dushanba</option>
                        <option value="2">Seshanba</option>
                        <option value="3">Chorshanba</option>
                        <option value="4">Payshanba</option>
                        <option value="5">Juma</option>
                        <option value="6">Shanba</option>
                        <option value="7">Yakshanba</option>
                    </select>
                </div>
                <div class="update_5"> </div>
            </div>
        </div>



    </div>
</div>
<div class="offcanvas offcanvas-end" style="width: 50%" tabindex="-1" id="GET_INFORMARION">
    <div class="offcanvas-header">
        <h5 class="font-size-22 mt-3 p-2 badge bg-dark">Guruh haqida ma'lumot</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body getInform"></div>
</div>
<div class="offcanvas offcanvas-end" style="width: 50%" tabindex="-1" id="UPDATE_GROUP_STATUS"
    aria-labelledby="UPDATE_GROUP_STATUS_LABEL">
    <div class="offcanvas-header">
        <h5 class="font-size-22 mt-3 p-2 badge bg-dark">Guruh statusini tahrirlash</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body ">
        <label class="form-label">Satausni tanlash</label>
        <select class="form-control select2" style="width: 100%" onchange="CHANGE_STATUS(this.value)"
            id="change_status_select">
            <option value="" selected>Tanlash</option>
            <option value="none">Blokdan chiqarish</option>
            <option value="forever">Butunlay bloklab qo'yish</option>
            <option value="pending">Vaqtinchalik muddatga bloklash</option>
        </select>

        <div class="mt-3" id="statusDATE">
            <label class="form-label">Bloklanadigan sanalarni kiriting</label>
            <div class="input-daterange input-group" id="datepicker5" data-date-format="dd M, yyyy"
                data-date-autoclose="true" data-provide="datepicker" data-date-container="#datepicker5">
                <input type="text" class="form-control" name="start" id="grouping_startDate"
                    placeholder="Boshlang'ich sana" />
                <input type="text" class="form-control" name="end" id="grouping_endDate" placeholder="Yankuniy sana" />
            </div>
        </div>

        <div class="group_canvas_status mt-3"></div>
    </div>
</div>
<div class="offcanvas offcanvas-end" style="width: 80%" tabindex="-1" id="DELETED">
    <div class="offcanvas-header">
        <h5 class="font-size-22 mt-3 p-2 badge bg-dark">Arxivdagi guruhlar</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <table class="table table-striped table-bordered dt-responsive nowrap text-center"
            style="border-collapse: collapse; border-spacing: 0; width: 100%">
            <thead>
                <tr>
                    <th style="width: 60%;">Guruh</th>
                    <th style="width: 30%;">Yaratilgan sana</th>
                    <th style="width: 10%;">Sozlama</th>
                </tr>
            </thead>
            <tbody class="get_archive"></tbody>
        </table>
    </div>
</div>








<script src="/assets/axios.min.js"></script>
<script src="/assets/jquery.min.js"></script>
<script src="/assets/notification.js"></script>
<script src="/assets/libs/inputmask/jquery.inputmask.min.js"></script>
<script src="/assets/js/pages/form-mask.init.js"></script>

<script>

    /* 
        @description: Managerga tegishli o'quv markazlarni olish
        @api: /api/user/decode
        @method: GET
    */
    async function getFilials(DATA, append) {
        const school = $(append);
        await school.html("");
        school.append(`<option value="">Filialni tanlang</option>`)
        DATA.forEach((item) => {
            school.append(` <option value="${item._id}">${item.name}</option>`);
        })
    }
    const Token = window.localStorage.getItem('user')
    axios.get('/api/user/decode', { headers: { authorization: Token } }).then((res) => {
        const id = res.data.id;
        axios.get(`/api/user/${id}`).then(async (res) => {
            const school = res.data.data.school
            getFilials(school, "#filterBySchool")
            getFilials(school, "#school_all")
            getFilials(school, "#update_school_alls")
        })
    })

    /* 
        @description: Guruhlarni tablega joylashtrish
        @api: /api/group/filter/:id 
        @method: GET
    */
    const HTML_append_element = async (DATA) => {
        const put_table = $(".put_tables");
        await put_table.html("");
        DATA.forEach((item, index) => {
            put_table.append(`
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.payment} so'm</td>
                        <td class="font-size-18"><span class="status_default"> </span></td>
                        <td>${new Date(item.createdAt).toLocaleDateString()}</td>
                        <td>

                            <div class="btn-group">
                                <button style="padding: 5px 9px; font-size: 16px;" type="button" class="btn btn-dark dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="fas fa-cog"></i>
                                    </button>
                                <div class="dropdown-menu">
                                    <a onclick="information('${item._id}')" data-bs-toggle="offcanvas" data-bs-target="#GET_INFORMARION" aria-controls="UPDATE_CANVAS" class="dropdown-item" href="#">Ma'lumot olish</a>
                                    <a onclick="get_one('${item._id}')" data-bs-toggle="offcanvas" data-bs-target="#UPDATE_CANVAS" aria-controls="UPDATE_CANVAS" class="dropdown-item" href="#">Tahrirlash</a>
                                    <a onclick="get_status('${item._id}')" data-bs-toggle="offcanvas" data-bs-target="#UPDATE_GROUP_STATUS" aria-controls="UPDATE_GROUP_STATUS" class="dropdown-item" href="#">Status holati</a>
                                </div>
                            </div>
                           
                        </td>
                    </tr>
                `);
            document.getElementsByClassName("status_default").forEach((innerValue, innerIndex) => {
                if (index == innerIndex) {
                    if (item.status_default == "none") {
                        innerValue.innerHTML = "Bloklanmagan";
                        innerValue.className = "status_default badge bg-success p-2";
                    }
                }
            });
            document.getElementsByClassName("status_default").forEach((innerValue, innerIndex) => {
                if (index == innerIndex) {
                    if (item.status_default == "forever") {
                        innerValue.innerHTML = "Butunlay bloklangan";
                        innerValue.className = "status_default badge bg-danger p-2";
                    }
                }
            });
            document.getElementsByClassName("status_default").forEach((innerValue, innerIndex) => {
                if (index == innerIndex) {
                    if (item.status_default == "pending") {
                        innerValue.innerHTML = "Vaqtinchalik blokda";
                        innerValue.className = "status_default badge bg-warning p-2";
                    }
                }
            })
        });

    }
    const filterSchool = (id) => {
        axios.get(`/api/group/filter/${id}`, {
            params: {
                actions: "active"
            }
        }).then(async (res) => {
            const DATA = res.data.data;
            HTML_append_element(DATA)
        })
    }
    const restart = () => {
        const school_top = document.getElementById("filterBySchool")
        const school_on_create = document.getElementById("school_all")
        if (school_top.value != "") {
            for (let item of school_top) {
                if (item.selected) {
                    filterSchool(item.value)
                }
            }
        } else {
            for (let item of school_on_create) {
                if (item.selected) {
                    filterSchool(item.value)
                }
            }
        }



    }
    /*  @description: FIltrlash jarayoni - malumot yartish uchun */
    const setSelections = async (DATA, APPENDING, MESSAGE) => {
        if (DATA == "") {
            const appends = $(APPENDING);
            await appends.html("");
            appends.append(`<option value="" selected>Mavjud emas</option> `);
            danger(MESSAGE);
        } else {
            const appends = $(APPENDING);
            await appends.html("");
            appends.append(`<option value="" selected>Tanlash</option> `);
            DATA.forEach((item) => {
                appends.append(
                    `<option value="${item._id}">${item.name}</option>`
                );
            });
        }
    }
    const FILTER_SCHOOL = (id) => {
        axios.get(`/api/school/${id}`).then(async (res) => {
            const data = res.data.data.category
            setSelections(data, "#category_all", "O'quv markazi uchun kategoriyalar biriktirilmagan. Iltimos kategoriya biriktiring")
        });
        axios.get(`/api/room/filter/${id}`, { params: { actions: "active" } }).then(async (res) => {
            const data = res.data.data;
            setSelections(data, "#room_all", "Ushbu o'quv markazining xonalari mavjud emas. Iltimos avval xonalar yarating")
        });
    }
    const FILTER_CATEGORY = (id) => {
        axios.get(`/api/speciality/filter/${id}`).then(async (res) => {
            const data = res.data.data
            setSelections(data, "#speciality_all", "Ushbu kategoriya bo'yicha yo'nalish mavjud emas")
        });
    }
    /* 
        @description: Yangi guruh yaratish
        @api: /api/room/create
        @method: POST
    */
    let statusAction = "";
    const changeStatus = (value) => {
        if (value == "pending") {
            document.getElementById("blokingStatus").style.display = "block";
            statusAction = "pending";
        }
        if (value == "none") {
            document.getElementById("blokingStatus").style.display = "none";
            statusAction = "none";
        }
        if (value == "forever") {
            document.getElementById("blokingStatus").style.display = "none";
            statusAction = "forever";
        }
    };
    const create = () => {
        const school_all = document.getElementById('school_all').value;
        const room_all = document.getElementById('room_all').value;
        const category_all = document.getElementById('category_all').value;
        const speciality_all = document.getElementById('speciality_all').value;
        const name = document.getElementById('name').value;
        const payment = document.getElementById('input-repeat').value;
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        const group_start_hour = document.getElementById('group_start_hour').value;
        const group_end_hour = document.getElementById('group_end_hour').value;
        const group_lesson_duration = document.getElementById('group_lesson_duration').value;
        const group_week = document.getElementById('group_week')
        const group_status = document.getElementById('group_status').value;
        const blocking_start_date = document.getElementById('blocking_start_date').value;
        const blocking_end_date = document.getElementById('blocking_end_date').value;
        const color = document.getElementById('color').value;
        if (group_status == "") {
            warning("Malumotni to'liq kiriting")
        }
        else {
            // 1.bloklanmagan holatda guruh yaratish
            if (group_status == "none") {
                const week = []
                for (let item of group_week) {
                    if (item.selected) {
                        const value = item.value;
                        week.push(value)
                    }
                }
                if (week.length < 1 || school_all == "" || room_all == "" || category_all == "" || speciality_all == "" || name == "" || startDate == "" || endDate == "" || group_start_hour == "" || group_lesson_duration == "" || group_week == "" || payment == "" || group_status == "") { warning("Malumotni to'liq kiriting"); }
                else {
                    axios.post('/api/group/create', {
                        school: school_all,
                        color: color,
                        room: room_all,
                        category: category_all,
                        speciality: speciality_all,
                        name: name,
                        payment: payment,
                        group_startDate: new Date(startDate).toISOString(),
                        group_endDate: new Date(endDate).toISOString(),
                        group_start_hour: group_start_hour,
                        group_end_hour: group_end_hour,
                        group_week: week,
                        group_lesson_duration: group_lesson_duration,
                        status_default: group_status,
                        blocking_start_date: "",
                        blocking_end_date: "",
                    })
                        .then((res) => {
                            restart()
                            success("Guruh yaratildi")
                        })
                }
            }
            // 2.butunlay bloklangan holatda guruh yaratish
            if (group_status == "forever") {
                const week = []
                for (let item of group_week) {
                    if (item.selected) {
                        const value = item.value;
                        week.push(value)
                    }
                }
                if (week.length < 1 || school_all == "" || category_all == "" || speciality_all == "" || name == "" || startDate == "" || endDate == "" || group_start_hour == "" || group_end_hour == "" || group_lesson_duration == "" || group_week == "" || payment == "" || group_status == "") { warning("Malumotni to'liq kiriting"); }
                else {
                    axios.post('/api/group/create', {
                        school: school_all,
                        category: category_all,
                        speciality: speciality_all,
                        name: name,
                        payment: payment,
                        group_startDate: new Date(startDate).toISOString(),
                        group_endDate: new Date(endDate).toISOString(),
                        group_start_hour: group_start_hour,
                        group_end_hour: group_end_hour,
                        group_week: week,
                        group_lesson_duration: group_lesson_duration,
                        status_default: group_status,
                        blocking_start_date: "",
                        blocking_end_date: "",
                    })
                        .then((res) => {
                            restart()
                        })
                }
            }
            // 3.vaqtinchalik bloklanmagan holatda guruh yaratish
            if (group_status == "pending") {
                const week = []
                for (let item of group_week) {
                    if (item.selected) {
                        const value = item.value;
                        week.push(value)
                    }
                }
                if (week.length < 1 || school_all == "" || category_all == "" || speciality_all == "" || name == "" || startDate == "" || endDate == "" || group_start_hour == "" || group_lesson_duration == "" || group_week == "" || payment == "" || group_status == "" || blocking_start_date == "" || blocking_end_date == "") { warning("Malumotni to'liq kiriting") }
                else {
                    axios.post('/api/group/create', {
                        school: school_all,
                        category: category_all,
                        speciality: speciality_all,
                        name: name,
                        payment: payment,
                        group_startDate: new Date(startDate).toISOString(),
                        group_endDate: new Date(endDate).toISOString(),
                        group_start_hour: group_start_hour,
                        group_end_hour: group_end_hour,
                        group_week: week,
                        group_lesson_duration: group_lesson_duration,
                        status_default: group_status,
                        blocking_start_date: new Date(blocking_start_date).toISOString(),
                        blocking_end_date: new Date(blocking_end_date).toISOString(),
                    })
                        .then((res) => {
                            restart()
                        })
                }
            }
        }
    }
    /* 
        @description: Guruhni bittalab olish
        @api: /api/group/:id
        @method: GET
    */
    const information = (id) => {
        axios.get(`/api/group/${id}`).then(async (res) => {
            const DATA = res.data.data;
            const get_canvas = $(".getInform");
            await get_canvas.html("");
            get_canvas.append(`
                <div class="list-group">
                    <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Guruh nomi: </h6>
                            <h6>${DATA.name}</h6>
                        </div>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Guruh to'lovi: </h6>
                            <h6>${DATA.payment}</h6>
                        </div>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Filial nomi: </h6>
                            <h6>${DATA.school.name}</h6>
                        </div>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Yo'nalish nomi: </h6>
                            <h6>${DATA.category.name}</h6>
                        </div>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Kurs nomi: </h6>
                            <h6>${DATA.speciality.name}</h6>
                        </div>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Xona turi: </h6>
                            <h6>${DATA.room.name}</h6>
                        </div>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Dars boshlanadigan vaqt </h6>
                            <h6 id="get_group_start_hour"> </h6>
                            
                        </div>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Dars boshlanadigan vaqt </h6>
                            <h6 id="get_group_end_hour"> </h6>
                            
                        </div>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Dars davomiyligi vaqti: </h6>
                            <h6>${DATA.group_lesson_duration} soat</h6>
                        </div>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Hafta kunlari </h6>
                            <h6 id="get_group_week"></h6>
                        </div>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action flex-column align-items-start disabled">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Boshlanadigan sana: </h6>
                            <h6>
                                <span class="badge bg-warning p-2 font-size-13">   
                                    ${new Date(DATA.group_startDate).toLocaleDateString()} 
                                </span>
                            </h6>
                        </div>
                        <div class="d-flex w-100 justify-content-between mt-2">
                            <h6 style="font-weight: 900;">Tugaydigan sana: </h6>
                            <h6>
                                <span class="badge bg-warning p-2 font-size-13">   
                                    ${new Date(DATA.group_endDate).toLocaleDateString()} 
                                </span>
                            </h6>
                        </div>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Status holati</h6>
                            <h6 id="getStatusGroup"></h6>
                        </div>
                    </a>
                    <a style="display: none;" id="pendingDatas" href="#" class="list-group-item list-group-item-action flex-column align-items-start disabled">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Ushbu sanadan blok holatiga tushadi </h6>
                            <h6>
                                <span class="badge bg-secondary p-2 font-size-13">   
                                    ${new Date(DATA.blocking_start_date).toLocaleDateString()} 
                                </span>
                            </h6>
                        </div>
                        <div class="d-flex w-100 justify-content-between mt-2">
                            <h6 style="font-weight: 900;">Ushbu sanadan blok holat yakunlanadi: </h6>
                            <h6>
                                <span class="badge bg-secondary p-2 font-size-13">   
                                    ${new Date(DATA.blocking_end_date).toLocaleDateString()} 
                                </span>
                            </h6>
                        </div>
                    </a>
                </div>
            `);
            const getStatusGroup = document.getElementById('getStatusGroup')
            const pendingDatas = document.getElementById('pendingDatas')
            if (DATA.status_default == "none") getStatusGroup.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> Bloklanmagan </span> `
            if (DATA.status_default == "forever") getStatusGroup.innerHTML = ` <span class=" p-2 badge bg-danger font-size-13"> Butunlay blok holatida  </span> `
            if (DATA.status_default == "pending") {
                getStatusGroup.innerHTML = ` <span class=" p-2 badge bg-secondary font-size-13"> Vaqtinchalik bloklangan  </span> `
                pendingDatas.style.display = "block"
            }
            // hafta kunlari boyicha
            const get_group_week = document.getElementById('get_group_week')
            const weeks = DATA.group_week
            for (let week of weeks) {
                if (week == "1") get_group_week.innerHTML += ` <span class=" p-2 badge bg-danger font-size-13"> Dushanba </span> `
                if (week == "2") get_group_week.innerHTML += ` <span class=" p-2 badge bg-danger font-size-13"> Seshanba </span> `
                if (week == "3") get_group_week.innerHTML += ` <span class=" p-2 badge bg-danger font-size-13"> Chorshanba </span> `
                if (week == "4") get_group_week.innerHTML += ` <span class=" p-2 badge bg-danger font-size-13"> Payshanba </span> `
                if (week == "5") get_group_week.innerHTML += ` <span class=" p-2 badge bg-danger font-size-13"> Juma </span> `
                if (week == "6") get_group_week.innerHTML += ` <span class=" p-2 badge bg-danger font-size-13"> Shanba </span> `
                if (week == "7") get_group_week.innerHTML += ` <span class=" p-2 badge bg-danger font-size-13"> Yakshanba </span> `
            }
            // darsning boshlanish vaqti
            const get_group_start_hour = document.getElementById('get_group_start_hour')
            const get_group_end_hour = document.getElementById('get_group_end_hour')

            // start date


            function setHoursToInformation(dataSetHours, setHours) {
                if (dataSetHours == "07:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 07:00 </span> `
                if (dataSetHours == "07:30") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 07:30 </span> `
                if (dataSetHours == "08:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 08:00 </span> `
                if (dataSetHours == "08:30") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 08:30 </span> `
                if (dataSetHours == "09:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 09:00 </span> `
                if (dataSetHours == "09:30") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 09:30 </span> `
                if (dataSetHours == "10:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 10:00 </span> `
                if (dataSetHours == "10:30") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 10:30 </span> `
                if (dataSetHours == "11:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 11:00 </span> `
                if (dataSetHours == "11:30") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 11:30 </span> `
                if (dataSetHours == "12:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 12:00 </span> `
                if (dataSetHours == "12:30") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 12:30 </span> `
                if (dataSetHours == "13:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 13:00 </span> `
                if (dataSetHours == "13:30") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 13:30 </span> `
                if (dataSetHours == "14:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 14:00 </span> `
                if (dataSetHours == "14:30") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 14:30 </span> `
                if (dataSetHours == "15:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 15:00 </span> `
                if (dataSetHours == "15:30") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 15:30 </span> `
                if (dataSetHours == "16:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 16:00 </span> `
                if (dataSetHours == "16:30") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 16:30 </span> `
                if (dataSetHours == "17:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 17:00 </span> `
                if (dataSetHours == "17:30") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 17:30 </span> `
                if (dataSetHours == "18:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 18:00 </span> `
                if (dataSetHours == "18:30") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 18:30 </span> `
                if (dataSetHours == "19:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 19:00 </span> `
                if (dataSetHours == "19:30") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 19:30 </span> `
                if (dataSetHours == "20:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 20:00 </span> `
                if (dataSetHours == "20:30") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 20:30 </span> `
                if (dataSetHours == "21:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 21:00 </span> `
                if (dataSetHours == "21:30") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 21:30 </span> `
                if (dataSetHours == "22:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 22:00 </span> `
                if (dataSetHours == "22:30") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 22:30 </span> `
                if (dataSetHours == "23:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 23:00 </span> `
                if (dataSetHours == "23:30") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 23:30 </span> `
                if (dataSetHours == "00:00") setHours.innerHTML = ` <span class=" p-2 badge bg-success font-size-13"> 00:00 </span> `

            }
            setHoursToInformation(DATA.group_start_hour, get_group_start_hour)
            setHoursToInformation(DATA.group_end_hour, get_group_end_hour)
        });
    }
    /* 
        @description: Guruhni statusini tahrirlash
        @api: /api/group/:id
        @method: PUT
    */
    const get_status = (id) => {
        axios.get(`/api/group/${id}`).then(async (res) => {
            const DATA = res.data.data;
            const group_canvas_status = $(".group_canvas_status");
            await group_canvas_status.html("");
            group_canvas_status.append(`
                <button type="button" onclick="update_status('${DATA._id}')" class=" mt-3 btn btn-success waves-effect waves-light mt-2">
                    Tahrirlash
                </button> 
            `);
        });
    };
    let StatusAction = "";
    const CHANGE_STATUS = (value) => {
        if (value == "pending") {
            document.getElementById("statusDATE").style.display = "block";
            statusAction = "pending";
        }
        if (value == "none") {
            document.getElementById("statusDATE").style.display = "none";
            statusAction = "none";
        }
        if (value == "forever") {
            document.getElementById("statusDATE").style.display = "none";
            statusAction = "forever";
        }
    };
    const update_status = (id) => {
        const status = document.getElementById("change_status_select").value;
        const startDate = document.getElementById("grouping_startDate").value;
        const endDate = document.getElementById("grouping_endDate").value;

        if (status == "") {
            warning("Malumotni to'liq kiriting");
        } else {
            if (statusAction == "none") {
                axios({
                    url: `/api/group/${id}`,
                    method: "PUT",
                    data: {
                        status_default: "none",
                        blocking_start_date: "",
                        blocking_end_date: "",
                    },
                }).then((res) => {
                    success("Guruh blokdan chiqarildi");
                    restart()
                });
            }
            if (statusAction == "forever") {
                axios({
                    url: `/api/group/${id}`,
                    method: "PUT",
                    data: {
                        status_default: "forever",
                        blocking_start_date: "",
                        blocking_end_date: "",
                    },
                }).then((res) => {
                    success("Guruh butunlay bloklandi");
                    restart()
                });
            }
            if (statusAction == "pending") {
                if (startDate == "" || endDate == "") {
                    warning("Boshlang'ich va yakuniy sanalarni to'liq kiriting");
                } else {
                    axios({
                        url: `/api/group/${id}`,
                        method: "PUT",
                        data: {
                            status_default: "pending",
                            blocking_start_date: new Date(startDate).toISOString(),
                            blocking_end_date: new Date(endDate).toISOString(),
                        },
                    }).then((res) => {
                        success("Guruh vaqtinchlik bloklandi");
                        restart()
                    });
                }
            }
        }
    };
    /* 
      @description: Guruhni arxivga qo'yish
      @api: /api/group/:id
      @method: PUT
    */
    const archiveData = (id) => {
        axios.put(`/api/group/${id}`, {
            actions: "archive"
        }).then((res) => {
            success("Muvaffaqiyatli o'chirildi");
            restart()
        });
    };

    /* 
       @description: Guruhni bittalab tahrirlash
       @api: /api/group/:id
       @method: PUT
   */
    const get_one = (id) => {
        axios.get(`/api/group/${id}`).then(async (res) => {
            const data = res.data.data;

            document.getElementById('group_update_name').value = data.name
            document.getElementById('group_update_payment').value = data.payment
            document.getElementById('group_update_color').value = data.color



            const update_1 = $(".update_1");
            await update_1.html("");
            update_1.append(`<button onclick="update_data_1('${data._id}')" class="btn btn-outline-success mt-2 " >Tahrirlash</button>`)

            const update_2 = $(".update_2");
            await update_2.html("");
            update_2.append(`<button onclick="update_data_2('${data._id}')" class="btn btn-outline-success mt-2 " >Tahrirlash</button>`)

            const update_3 = $(".update_3");
            await update_3.html("");
            update_3.append(`<button onclick="update_data_3('${data._id}')" class="btn btn-outline-success mt-2 " >Tahrirlash</button>`)

            const update_4 = $(".update_4");
            await update_4.html("");
            update_4.append(`<button onclick="update_data_4('${data._id}')" class="btn btn-outline-success mt-2 " >Tahrirlash</button>`)

            const update_5 = $(".update_5");
            await update_5.html("");
            update_5.append(`<button onclick="update_data_5('${data._id}')" class="btn btn-outline-success mt-2 " >Tahrirlash</button>`)

        });
    };
    const UPDATE_FILTER_SCHOOL = (id) => {
        axios.get(`/api/school/${id}`).then(async (res) => {
            const data = res.data.data.category
            setSelections(data, "#update_category_alls", "O'quv markazi uchun kategoriyalar biriktirilmagan. Iltimos kategoriya biriktiring")
        });
        axios.get(`/api/room/filter/${id}`, { params: { actions: "active" } }).then(async (res) => {
            const data = res.data.data;
            setSelections(data, "#update_room_alls", "Ushbu o'quv markazining xonalari mavjud emas. Iltimos avval xonalar yarating")
        });
    }
    const UPDATE_FILTER_CATEGORY = (id) => {
        axios.get(`/api/speciality/filter/${id}`).then(async (res) => {
            const data = res.data.data
            setSelections(data, "#update_speciality_alls", "Ushbu kategoriya bo'yicha yo'nalish mavjud emas")
        });
    }

    const update_data_1 = (id) => {
        const school = document.getElementById("update_school_alls").value;
        const category = document.getElementById("update_category_alls").value;
        const speciality = document.getElementById("update_speciality_alls").value;
        const room = document.getElementById("update_room_alls").value;
        if (school == "" || category == "" || speciality == "" || room == "") {
            warning("Malumotni to'liq kiriting")
        }
        else {
            axios.put(`/api/group/${id}`, {
                school: school,
                room: room,
                category: category,
                speciality: speciality
            }).then((res) => {
                success("Muvaffaqiyatli tahrirlandi")
                filterSchool(school)
            })
        }

    }
    const update_data_2 = (id) => {
        const name = document.getElementById("group_update_name").value
        const payment = document.getElementById("group_update_payment").value
        if (name == "" || payment == "") {
            warning("Malumotni to'liq kiriting")
        }
        else {
            axios.put(`/api/group/${id}`, {
                name: name,
                payment: payment,
            }).then((res) => {
                success("Muvaffaqiyatli tahrirlandi")
                filterSchool(res.data.school)
            })
        }
    }
    const update_data_3 = (id) => {
        const color = document.getElementById("group_update_color").value
        if (color == "") {
            warning("Malumotni to'liq kiriting")
        }
        else {
            axios.put(`/api/group/${id}`, {
                color: color,
            }).then((res) => {
                success("Muvaffaqiyatli tahrirlandi")
                filterSchool(res.data.school)
            })
        }
    }
    const update_data_4 = (id) => {
        const started = document.getElementById("update_group_started").value
        const ended = document.getElementById("update_group_ended").value
        const alls = document.getElementById("update_group_houres").value
        if (
            started == "" ||
            ended == "" ||
            alls == ""
        ) {
            warning("Malumotni to'liq kiriting")
        }
        else {
            axios.put(`/api/group/${id}`, {
                group_start_hour: started,
                group_end_hour: ended,
                group_lesson_duration: alls,
            }).then((res) => {
                success("Muvaffaqiyatli tahrirlandi")
                filterSchool(res.data.school)
            })
        }
    }
    const update_data_5 = (id) => {

        const weeks = document.getElementById("update_group_weeks")
        if (
            weeks == ""
        ) {
            warning("Malumotni to'liq kiriting")
        }
        else {
            const week = []
            for (let item of weeks) {
                if (item.selected) {
                    const value = item.value;
                    week.push(value)
                }
            }
            axios.put(`/api/group/${id}`, {
                group_week: week,
            }).then((res) => {
                success("Muvaffaqiyatli tahrirlandi")
                filterSchool(res.data.school)
            })
        }
    }


</script>