<style>
    #school_password {
        -webkit-text-security: disc;

    }
</style>

<div class="row">
    <div class="col-12">
        <div class="row">
            <div class="col-12">
                <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                    <h3 class="mb-sm-0">O'quv markazlar bo'limi</h3>

                    <div class="page-title-right">
                        <ol class="breadcrumb m-0">
                            <li class="breadcrumb-item"><a href="/manager/dashboard/general">Asosiy sahifa</a></li>
                            <li class="breadcrumb-item active">O'quv markazlar</li>
                        </ol>
                    </div>

                </div>
            </div>
        </div>


        <button class="btn btn-primary " type="button" data-bs-toggle="offcanvas" data-bs-target="#CREATE_CANVAS"
            aria-controls="CREATE_CANVAS">
            <i class="far fa-plus-square"></i>
            Qo'shish
        </button>
        <div class="card mt-3">
            <div class="card-body">
                <table class="table table-striped table-bordered dt-responsive nowrap text-center"
                    style="border-collapse: collapse; border-spacing: 0; width: 100%">
                    <thead>
                        <tr>
                            <th>O'quv markazi</th>
                            <th>Lid manzil</th>
                            <th>Yo'nalishlar</th>
                            <th>Ma'lumot</th>
                            <th>SMS</th>
                            <th>Yaratilgan sana</th>
                            <th>Sozlama</th>
                        </tr>
                    </thead>
                    <tbody class="setTables"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="offcanvas offcanvas-end" style="width: 50%" tabindex="-1" id="CREATE_CANVAS">
    <div class="offcanvas-header">
        <h5 class="font-size-22 mt-3 p-2 badge bg-dark">O'quv markazi yaratish</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <label class="form-label">Viloyatni tanlang</label>
        <select class="form-control select2" style="width: 100%" onchange="filterRegion(this.value)"
            id="region_all"></select>

        <label class="form-label mt-3">Tumanni tanlang</label>
        <select class="form-control select2" style="width: 100%" id="district_all"></select>

        <label class="mb-1 mt-3">Yo'nalishlarni tanlang</label>
        <select class="select2 form-control select2-multiple" multiple="multiple" id="category_all"></select>

        <label class="mb-1 mt-3">Yangi o'quv markaz nomi</label>
        <input class="form-control" style="width: 100%" id="school_name" />


        <label class="mb-1 mt-3">Telefon raqam</label>
        <input class="form-control" style="width: 100%" id="school_phone" />

        <p id="addnew pt-3">
            <a class="badge bg-warning font-size-14 mt-3 p-2" href="javascript:new_link()">
                <i class="far fa-plus-square"></i>
                Qo'shimcha ma'lumotlar qo'shish
            </a>
        </p>
        <div id="newlinktpl" style="display: none">
            <textarea cols="20" rows="3" class="form-control mt-3 school_description"></textarea>
        </div>
        <div id="newlink" class="mt-3"></div>

        <button type="button" onclick="create()"
            class="btn btn-outline-success col-md-12 col-sm-12 waves-effect waves-light mt-2">
            <i class=" far fa-check-circle"></i>
            Yaratish
        </button>
    </div>
</div>
<div class="offcanvas offcanvas-end" style="width: 50%" tabindex="-1" id="UPDATE_CANVAS">
    <div class="offcanvas-header">
        <h5 class="font-size-22 mt-3 p-2 badge bg-dark"> O'quv markazni tahrirlash</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body get_canvas"></div>
</div>
<div class="offcanvas offcanvas-end" style="width: 50%" tabindex="-1" id="SEE_CATEGORIES">
    <div class="offcanvas-header">
        <h5 class="font-size-22 mt-3 p-2 badge bg-dark">Yo'nalishlarni ko'rish</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <div class="add_new_category_list"></div>
    </div>
</div>
<div class="offcanvas offcanvas-end" style="width: 50%" tabindex="-1" id="SUBDOMAIN">
    <div class="offcanvas-header">
        <h5 class="font-size-22 mt-3 p-2 badge bg-dark">Yangi subdomen biriktirish</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body ">

        <div class="mb-4">
            <label class="form-label">Sub domain qo'shish </label>
            <input id="input-repeat" class="form-control input-mask" onkeyup="changeSubDomains('input-repeat')"
                data-inputmask="'mask': '9{1,3}-a{1,50}'">
        </div>

        <div class="subDomains"></div>
    </div>
</div>
<div class="offcanvas offcanvas-end" style="width: 50%" tabindex="-1" id="CREATE_CATEGORY">
    <div class="offcanvas-header">
        <h5 class="font-size-22 mt-3 p-2 badge bg-dark">Yangi yo'nalish biriktirish</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>


    <div class="all_categories_school">  </div>

    <div class="offcanvas-body add_category">
        <label class="form-label">Yo'nalishlarni tanlang</label>
        <select class="select2 form-control select2-multiple" multiple="multiple" id="create_new_category_id"></select>
        <div class="create_new_category_class mt-1"></div>
    </div>
</div>
<div class="offcanvas offcanvas-end" style="width: 50%" tabindex="-1" id="INFORMATION">
    <div class="offcanvas-header">
        <h5 class="font-size-22 mt-3 p-2 badge bg-dark">O'quv markaz haqida to'liq ma'lumot</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body filial_information">
        <div class="filial_information"></div>
        <div class="filial_descrtiption list-group"> </div>
    </div>
</div>
<!-- SMS tizimini o'rnatish -->
<div class="offcanvas offcanvas-end" style="width: 50%" tabindex="-1" id="SET_SMS">
    <div class="offcanvas-header">
        <h5 class="font-size-22 mt-3 p-2 badge bg-dark"> O'quv markaziga SMS tizimini ulash</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body setSMS_HTMLS">

    </div>
</div>
<!-- SMS tizimini o'chirish -->
<div class="offcanvas offcanvas-end" style="width: 50%" tabindex="-1" id="CANCEL_SMS">
    <div class="offcanvas-header">
        <h5 class="font-size-22 mt-3 p-2 badge bg-dark"> O'quv markazininf SMS tizimini o'chirish</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body cancelSMS">

    </div>
</div>

<script src="/assets/axios.min.js"></script>
<script src="/assets/jquery.min.js"></script>
<script src="/assets/notification.js"></script>
<script src="/assets/libs/inputmask/jquery.inputmask.min.js"></script>
<script src="/assets/js/pages/form-mask.init.js"></script>
<script>

    const changeSubDomains = (ids) => {
        const url = document.getElementById(ids).value
        url.trim()
        url.toLowerCase()
    }
    $(document).ready(function () {
        $("#school_phone").inputmask("999-99-999-99-99"); // static mask
    });

    // @description:Userga oid yo'nalishlarni olish
    // @api: /api/user/:id
    // @mentod: GET
    const user_token = window.localStorage.getItem('user');
    const setSelectionSingle = async (DATA, APPENDING, MESSAGE) => {
        if (DATA == "") {
            const appends = $(APPENDING);
            await appends.html("");
            appends.append(`<option value="" selected>Mavjud emas</option> `);
            danger(MESSAGE);
        } else {
            const appends = $(APPENDING);
            await appends.html("");
            appends.append(`<option value="" selected>Tanlash</option> `);
            DATA.forEach((item) => {
                appends.append(
                    `<option value="${item._id}">${item.name}</option>`
                );
            });
        }
    }
    const setSelectionMultiples = async (DATA, APPENDING, MESSAGE) => {
        if (DATA == "") {
            const appends = $(APPENDING);
            await appends.html("");
            danger(MESSAGE);
        } else {
            const appends = $(APPENDING);
            await appends.html("");
            DATA.forEach((item) => {
                appends.append(
                    `<option value="${item._id}">${item.name}</option>`
                );
            });
        }
    }
    axios.get('/api/user/decode', { headers: { authorization: user_token } }).then((res) => {
        const id = res.data.id;
        axios.get(`/api/user/${id}`).then(async (res) => {
            const category = res.data.data.category;
            setSelectionMultiples(category, "#category_all", "Ma'lumot mavjud emas")
            setSelectionMultiples(category, "#create_new_category_id", "Ma'lumot mavjud emas")
        });
    });

    // @description: Hamma viloyatlarni olish
    // @api: /api/region/all
    // @mentod: GET
    axios.get("/api/region/all", { params: { actions: "active" } }).then(async (res) => {
        const data = res.data.data;
        setSelectionSingle(data, "#region_all", "Viloyatlar mavjud emas")
    });


    // @description:Viloyat boyicha tumanlarni olish
    // @api: /api/destrict/filter/all
    // @mentod: GET
    const filterRegion = (id) => {
        axios.get(`/api/district/filter/${id}`, { params: { actions: "active" } }).then(async (res) => {
            const data = res.data.data;
            setSelectionSingle(data, "#district_all", "Tumanlar mavjud emas")
        });
    };

    // @description: O'quv markaz uchun SMS tizimini ulash
    // @api: /api/school/:id
    // @mentod: PUT
    const setSMS_HTML = (id) => {
        const setSMS_HTMLS = $(".setSMS_HTMLS");
        setSMS_HTMLS.html("");
        setSMS_HTMLS.append(`
            <label class="mb-1 mt-3">Email pochtani kiriting</label>
            <input class="form-control" style="width: 100%" id="sms_email" />

            <label class="mb-1 mt-3">Token manzilni kiriting</label>
            <input class="form-control" style="width: 100%" id="sms_token" />

            <div class="row">
                <button type="button" onclick="setSmsSystem('${id}')"
                    class="btn btn-primary col-md-4 offset-1  col-sm-12 waves-effect waves-light mt-3">
                    <i class="far fa-check-circle"></i>
                    Tizimga ulash
                </button>
                <button type="button" 
                    class="btn btn-dark col-md-4 offset-1  col-sm-12 waves-effect waves-light mt-3">
                    <i class="far fa-hand-point-right"></i>
                    Yo'riqnoma
                </button>
            </div>
        
        `)
    }
    const setSmsSystem = (id) => {
        const sms_email = document.getElementById("sms_email").value;
        const sms_token = document.getElementById("sms_token").value;
        if (sms_email == "" || sms_token == "") {
            danger("SMS uchun formani to'liq kiriting")
        }
        else {

            axios.post('/api/sms/check', {
                email: sms_email,
                password: sms_token
            })
                .then((res) => {
                    const message = res.data.message
                    if (message === "token_generated") {
                        axios.put(`/api/school/${id}`, {
                            sms: {
                                status: "1",
                                sms_email: sms_email,
                                sms_token: sms_token,
                            }
                        })
                            .then((res) => {
                                success("SMS tizimi muvaffaqiyatli ulandi")
                                get_active_schools()
                            })
                    }
                    else {
                        danger("Eskiz.uz saytidan ma'lumotlar generatsiya bo'lmagan! Iltimos qayta tekshiring")
                    }
                })
                .catch((error) => {
                    const message = error;
                    console.log(message)
                })
        }
    }



    // @description: O'quv markaz uchun SMS tizimini o'chirish
    // @api: /api/school/:id
    // @mentod: PUT
    const canceling_sms = (id) => {
        const cancelSMS = $(".cancelSMS");
        cancelSMS.html("");
        cancelSMS.append(`
            <div class="row">
                <button type="button" onclick="cancelSchoolSMS('${id}')"
                    class="btn btn-warning col-md-10 offset-1 col-sm-10 waves-effect waves-light mt-3">
                    <i class="far fa-check-circle"></i>
                    Tizimni o'chirishga roziman
                </button>
            </div>
        `)
    }
    const cancelSchoolSMS = (id) => {
        axios.put(`/api/school/${id}`, {
            sms: {
                status: "0",
                sms_email: "none",
                sms_token: "none",
            }
        })
            .then((res) => {
                success("SMS tizimi muvaffaqiyatli o'chirildi")
                get_active_schools()
            })
    }


    // @description: Managerga tegishli AKTIVE o'quv markazlarni olish
    // @api: /api/school/manager/:id
    // @mentod: GET
    const get_active_schools = () => {
        const userTOKEN = window.localStorage.getItem('user')
        axios.get('/api/user/decode', { headers: { authorization: user_token } }).then((res) => {
            const id = res.data.id;
            axios.get(`/api/school/manager/${id}`, {
                params: {
                    actions: "active"
                }
            }).then(async (res) => {
                const response = res.data.data;
                const setTables = $('.setTables')
                await setTables.html("");
                response.forEach((item, index) => {
                    setTables.append(`
                        <tr>    
                            <td>${item.name}</td>
                            <td class="leadsUrl"></td>
                            <td>
                                <span style="cursor: pointer;" class="badge bg-primary font-size-12 p-2" onclick="seeCategories('${item._id}')" data-bs-toggle="offcanvas" data-bs-target="#SEE_CATEGORIES" aria-controls="SEE_CATEGORIES"> 
                                    <i class="fas fa-eye"> </i>
                                    Ko'rish   
                                </span>
                            </td>
                            <td>
                                <span style="cursor: pointer;" class="badge bg-primary font-size-12 p-2" onclick="get_information('${item._id}')"  data-bs-toggle="offcanvas" data-bs-target="#INFORMATION" aria-controls="INFORMATION"> 
                                    <i class="fas fa-eye"> </i>
                                    Ko'rish   
                                </span>
                            </td>
                            <td class="checkSMS"></td>
                            <td>${new Date(item.createdAt).toLocaleDateString()}</td>
                            <td>
                                <div class="btn-group">
                                    <button style="padding: 5px 9px; font-size: 16px;" type="button" class="btn btn-dark dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="fas fa-cog"></i>
                                    </button>
                                    <div class="dropdown-menu">
                                        <a style="font-weight: 700;" onclick="subDomain('${item._id}')"  data-bs-toggle="offcanvas" data-bs-target="#SUBDOMAIN" aria-controls="SUBDOMAIN" class="dropdown-item text-primary" href="#">Lid qo'shish va tahrirlash</a>
                                        <a style="font-weight: 700;" onclick="add_category('${item._id}')"  data-bs-toggle="offcanvas" data-bs-target="#CREATE_CATEGORY" aria-controls="CREATE_CATEGORY" class="dropdown-item text-dark" href="#">Yo'nalish qo'shish</a>
                                        <a style="font-weight: 700;" onclick="get_context('${item._id}')" data-bs-toggle="offcanvas" data-bs-target="#UPDATE_CANVAS" aria-controls="UPDATE_CANVAS" class="dropdown-item text-dark" href="#">Tahrirlash</a>
                                        <a style="font-weight: 700;" onclick="get_description('${item._id}')"  data-bs-toggle="offcanvas" data-bs-target="#UPDATE_CANVAS" aria-controls="UPDATE_CANVAS" class="dropdown-item text-dark" href="#">Ma'lumotlarni tahrirlash</a>
                                        <a style="font-weight: 700;" onclick="setLogo('${item._id}')"  data-bs-toggle="offcanvas" data-bs-target="#UPDATE_CANVAS" aria-controls="UPDATE_CANVAS" class="dropdown-item text-dark" href="#">Logo qo'shish</a>
                                        <a style="font-weight: 700;" onclick="deleteFilial('${item._id}')"  data-bs-toggle="offcanvas"  class="dropdown-item text-danger" href="#">O'chirish</a>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    `)

                    const leadsUrl = document.getElementsByClassName("leadsUrl");
                    leadsUrl.forEach((inputs, inputsIndex) => {
                        if (inputsIndex == index) {
                            if (item.subDomain == "" || !item.subDomain || item.subDomain == undefined) {
                                inputs.innerHTML = `
                                <span    class="badge bg-danger font-size-12 p-2" >
                                    <i class="far fa-times-circle"></i>
                                    Mavjud emas
                                </span>
                                `
                            }
                            else {
                                inputs.innerHTML = `
                                <span  class="badge bg-dark font-size-12 p-2" >
                                    ${window.location.host}/${item.subDomain}
                                </span>
                                `
                            }
                        }
                    })


                    // const leadsUrl = document.getElementsByClassName("leadsUrl");
                    // leadsUrl.forEach((inputs, inputsIndex) => {
                    //     if (inputsIndex == index) {
                    //         if (item.subDomain == "" || !item.subDomain || item.subDomain == undefined) {
                    //             inputs.innerHTML = `<span  style="cursor: pointer;"  class="badge bg-danger font-size-12 p-2" >
                    //                 <i class="far fa-times-circle"></i>
                    //                 Mavjud emas
                    //             </span>`
                    //         }
                    //         else {
                    //             inputs.innerHTML = `
                    //                 <input id="copy_url_${index}"  value="${window.location.origin}/${item.subDomain}" style="font-size: 10px; backgroup: transpatent; display: none;"  disabled type="text" />
                    //                 <span style="cursor: pointer;"  onclick="copyUrl('copy_url_${index}')"  class="badge bg-success font-size-12 p-2"> 
                    //                     <i class="far fa-copy"></i>
                    //                     Nusxa olish
                    //                 </span>
                    //             `
                    //         }
                    //     }
                    // })
                    const checkSMS = document.getElementsByClassName("checkSMS");
                    checkSMS.forEach((inputs, inputsIndex) => {
                        if (inputsIndex == index) {
                            if (item.sms.status == "0" && item.sms.sms_email == "none" && item.sms.sms_token == "none") {
                                inputs.innerHTML = `
                                    <span onclick="setSMS_HTML('${item._id}')" style="cursor: pointer;" class="badge bg-danger font-size-12 p-2"  data-bs-toggle="offcanvas" data-bs-target="#SET_SMS" aria-controls="SET_SMS">
                                        <i class="far fa-times-circle"></i>
                                        Sms yoqilmagan
                                    </span>
                                `
                            }
                            if (item.sms.status == "1" && item.sms.sms_email != "none" && item.sms.sms_token != "none") {
                                inputs.innerHTML = `
                                    <span onclick="canceling_sms('${item._id}')" data-bs-toggle="offcanvas" data-bs-target="#CANCEL_SMS" aria-controls="CANCEL_SMS"  style="cursor: pointer;"  class="badge bg-success font-size-12 p-2">
                                        <i class="far fa-check-circle"></i>
                                        Sms yoqilgan
                                    </span>
                                `
                            }
                        }
                    })
                })
            });
        });
    }
    get_active_schools()



    // @description: O'quv markazga tegishli kategoriyalarni ko'rish
    // @api: /api/school/create
    // @mentod: POST
    const seeCategories = (id) => {
        axios.get(`/api/school/${id}`).then(async (res) => {
            const DATA = res.data.data;
            const CATEGORY = DATA.category; // []
            const lists = $(".add_new_category_list");
            await lists.html("");
            CATEGORY.forEach((item, index) => {
                lists.append(`
                    <div class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;0">${(index += 1)} - yo'nalish: </h6>
                            <h6 >${item.name}</h6>
                        </div>
                    </div>
                `);
            });
        });
    };


    // @description: Yangi o'quv markazi yaratish
    // @api: /api/school/create
    // @mentod: POST
    let ct = 1;
    function new_link() {
        ct++;
        let div1 = document.createElement('div');
        div1.id = ct
        let delLink = '<a class="badge bg-danger p-1 font-size-12 mt-1 p-2" href="javascript:delIt(' + ct + ')">O\'\chirish</a></div>'

        div1.innerHTML = document.getElementById('newlinktpl').innerHTML + delLink;
        document.getElementById('newlink').appendChild(div1);
    }
    function delIt(eleId) {
        d = document;
        let ele = d.getElementById(eleId);
        let parentEle = d.getElementById('newlink');
        parentEle.removeChild(ele);
    }
    
    
    
    
    const create = () => {
        const region_all = document.getElementById("region_all").value
        const district_all = document.getElementById("district_all").value
        const category_all = document.getElementById("category_all")
        const school_name = document.getElementById("school_name").value
        const school_phone = document.getElementById("school_phone").value
        // description bilan ishlash
        const array_description = [];
        const desc_inputs = document.querySelectorAll('.school_description')
        for (let i = 1; i < desc_inputs.length; i++) {
            array_description.push(desc_inputs[i].value)
        }
        // categoriyalar bilan ishlash
        const category_array = []
        for (let item of category_all) {
            const values = item
            if (values.selected) {
                category_array.push(values.value)
            }
        }
        if (array_description.length == "" || array_description.length == [] || category_array.length == "" || category_array.length == [] || region_all == "" || district_all == "" || school_name == "" || school_phone == "") { warning("Barcha ma'lumotlarni to'liq kiriting") }
        else {

            axios.get('/api/user/decode', { headers: { authorization: user_token } }).then((res) => {
                const managerID = res.data.id;
                axios.post("/api/school/create", {
                    region: region_all,
                    district: district_all,
                    manager: managerID,
                    category: category_array,
                    name: school_name,
                    phone: school_phone,
                    school_descrtiption: array_description,
                })
                    .then((res) => {
                        success("Muvaffaqiyatli yaratildi")
                        get_active_schools()
                    })
            })
        }
    }

    // @description:O'quv markazini tahrirlash -  [ name, phone ]
    // @api: /api/school/:id
    // @mentod: PUT
    const get_context = (id) => {
        axios.get(`/api/school/${id}`).then(async (res) => {
            const DATA = res.data.data
            const get_canvas = $('.get_canvas')
            await get_canvas.html("")
            get_canvas.append(`
                <label class="mb-1 ">Yangi filialni nomi</label>
                <input type="text" class="form-control" value="${DATA.name}" maxlength="40" id="name_edit">
                <label class="mb-1 mt-3">Yangi telefon raqami</label>
                <input type="text" class="form-control" value="${DATA.phone}" maxlength="40" id="phone_edit">
                <button type="button" onclick="update_context('${DATA._id}')" class="btn btn-success waves-effect waves-light mt-1">Tahrirlash</button>
            `)
            $(document).ready(function () {
                $("#phone_edit").inputmask("999-99-999-99-99");  //static mask
            });
        })
    }
    const update_context = (id) => {
        const name = document.getElementById('name_edit').value;
        const phone = document.getElementById('phone_edit').value;
        if (name == "" || phone == "") {
            warning("Malumotni to'liq kiriting")
        }
        else {
            axios({
                url: `/api/school/${id}`,
                method: "PUT",
                data: {
                    name: name,
                    phone: phone,
                }
            })
                .then((res) => {
                    success("Muvaffaqiyatli tahrirlandi")
                    get_active_schools()
                })
        }
    }



    // @description:O'quv markazini tahrirlash -  [ description ]
    // @api: /api/school/:id
    // @mentod: PUT
    let description_count = 1;
    function description_link() {
        description_count++;
        let div1 = document.createElement('div');
        div1.id = description_count
        let delLink = '<a class="badge bg-danger p-1 font-size-12 mt-1" href="javascript:description_delete(' + description_count + ')">O\'\chirish</a></div>'

        div1.innerHTML = document.getElementById('new_description_link').innerHTML + delLink;
        document.getElementById('New_Description_array').appendChild(div1);
    }
    function description_delete(eleId) {
        d = document;
        let ele = d.getElementById(eleId);
        let parentEle = d.getElementById('New_Description_array');
        parentEle.removeChild(ele);
    }
    const get_description = (id) => {
        axios.get(`/api/school/${id}`).then(async (res) => {
            const DATA = res.data.data
            const get_canvas = $('.get_canvas')
            await get_canvas.html("")
            get_canvas.append(`
                <p id="addnew pt-3">
                    <a class="badge bg-primary font-size-14 mt-3 p-2" href="javascript:description_link()">
                        <i class="far fa-plus-square"></i>
                        Qo'shimcha ma'lumotlar qo'shish
                    </a>
                    
                </p>
                <div id="new_description_link" style="display: none">
                    <textarea cols="20" rows="3" class="form-control mt-3 school_description_edit"></textarea>
                </div>
                <div id="New_Description_array" class="mt-3"></div>
                
                <button type="button" onclick="update_description('${DATA._id}')" class="btn btn-success waves-effect waves-light mt-3">Tahrirlash</button>
            `)
        })
    }
    const update_description = (id) => {
        const array_description = [];

        const desc_inputs = document.querySelectorAll('.school_description_edit')
        for (let i = 1; i < desc_inputs.length; i++) {
            array_description.push(desc_inputs[i].value)
        }
        if (
            array_description.length < 1
        ) {
            warning("Barcha ma'lumotlarni to'liq kiriting")
        }
        else {
            axios.put(`/api/school/${id}`, {
                school_descrtiption: array_description,
            }).then((res) => {
                success("Muvaffaqiyatli tahrirlandi")
                get_active_schools()
            })
        }
    }


    // @description: O'quv markazini tahrirlash -  [ category ]
    // @api: /api/school/:id
    // @mentod: PUT
    const add_category = (id) => {


        axios.get(`/api/school/${id}`).then(async (res) => {
            const DATA = res.data.data;

            const CATEGORY = DATA.category; // []
            const lists = $(".all_categories_school");
            await lists.html("");
            CATEGORY.forEach((item, index) => {
                lists.append(`
                    <div style="width: 80%; margin: 10px 10%; height: 50px; display: flex; flex-direction: row; justify-content: space-between; align-items: center; border-radius: 10px; border: 1px solid #505050; padding: 20px;">
                        <h6 style="font-weight: 900;0">${(index += 1)} - yo'nalish: </h6>
                        <h6 >${item.name}</h6>
                    </div>
                `);
            });


            const create_new_category_class = $('.create_new_category_class')
            await create_new_category_class.html("")
            create_new_category_class.append(`<button type="button" onclick="add_category_new('${DATA._id}')" class="btn btn-success waves-effect waves-light mt-3">Tahrirlash</button>`)
        });
    }
    const add_category_new = (id) => {
        const category = document.getElementById('create_new_category_id');
        const category_array = []
        for (let item of category) {
            if (item.selected) {
                const value = item.value;
                category_array.push(value)
            }
        }
        if (category_array == "" || category_array == [] || category_array.length < 1) {
            warning("Malumotni to'liq kiriting")
        }
        else {
            axios({
                url: `/api/school/${id}`,
                method: "PUT",
                data: {
                    category: category_array
                }
            })
                .then((res) => {
                    success("Muvaffaqiyatli tahrirlandi")
                    add_category(id)
                    get_active_schools()
                })
        }
    }


    // @description: O'quv markaz haqida ma'lumot olish
    // @api: /api/school/:id
    // @mentod: GET
    const get_information = (id) => {
        axios.get(`/api/school/${id}`).then(async (res) => {
            const DATA = res.data.data;
            const filial_information = $(".filial_information");
            await filial_information.html("");
            filial_information.append(`
                <div class="list-group">

                    <div class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <img class="rounded col-md-6 offset-3" src="/assets/logo/1.jpg" id="school_logotip"  >
                        </div>
                    </div>

                    <div  class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Filial nomi: </h6>
                            <h6>${DATA.name}</h6>
                        </div>
                    </div>
                    <div  class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Filial telefon raqami: </h6>
                            <h6>${DATA.phone}</h6>
                        </div>
                    </div>
                    <div  class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Viloyat  nomi: </h6>
                            <h6>${DATA.region.name}</h6>
                        </div>
                    </div>
                    <div class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Tuman nomi: </h6>
                            <h6 >${DATA.district.name}</h6>
                        </div>
                    </div>
                    <div class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 style="font-weight: 900;">Kirish kodi: </h6>
                            <h6 id="COPY">${DATA.code}</h6>
                        </div>
                    </div>
                </div>
            `);
            if (DATA.image.length == 1) {
                document.getElementById('school_logotip').src = `/school/${DATA.image[0]}`
            }
            const description = DATA.school_descrtiption // []
            const filial_descrtiption = $(".filial_descrtiption");
            await filial_descrtiption.html("");
            description.forEach((element, index) => {
                filial_information.append(`
                    <div class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h6  style="font-weight: 900; padding-right: 20px;">[${index += 1}] </h6> 
                            <h6  id="COPY" style="word-break: break-all;">${element}</h6>
                        </div>
                    </div>
                `)
            });
        });

    }


    // @description: O'quv markazini tahrirlash -  [ logotip ]
    // @api: /api/school/:id
    // @mentod: PUT 
    const setLogo = (id) => {
        axios.get(`/api/school/${id}`).then(async (res) => {
            const DATA = res.data.data
            const get_canvas = $('.get_canvas')
            await get_canvas.html("")
            get_canvas.append(`
                <div class="card-body">
                    <h4 class="card-title">Yangi logotip yuklang</h4>
                    <div class="input-group">
                        <input type="file" multiple class="form-control" id="image_upadtes">
                    </div>
                </div>
                <div class="text-center mt-4">
                    <button  onclick="setLogo_function('${DATA._id}')" type="button" class="btn btn-primary waves-effect waves-light">Send Files</button>
                </div>
            `)
        })
    }
    const setLogo_function = (id) => {
        const formData = new FormData()
        const image = document.getElementById('image_upadtes').files[0]
        formData.append("image", image)

        if (!image || image === "" || image == {} || image == []) {
            warning("Rasm mavjud emas, Iltimos rasmni yuklang !!!")
        } else {
            axios({
                method: "PUT",
                url: `/api/school/logo/${id}`,
                data: formData,
                headers: {
                    'Content-Type': 'multipart/form-data'
                }
            }).then((res) => {
                success("Logotip muvaffaqiyatli qo'shildi !!!")
                get_active_schools()
            });
        }
    }


    // @description: O'quv markazini arxivlashtirish
    // @api: /api/school/:id
    // @mentod: PUT 
    const deleteFilial = (id) => {
        axios.put(`/api/school/${id}`, {
            actions: "archive"
        }).then((res) => {
            success("Muvaffaqiyatli o'chirildi")
            get_active_schools()
        })
    }



    // @description: Sub domain qo'shish lid uchun
    // @api: /api/school/:id
    // @mentod: PUT
    const subDomain = (id) => {
        axios.get(`/api/school/${id}`).then(async (res) => {
            const DATA = res.data.data;
            const subDomains = $('.subDomains')
            await subDomains.html("")
            subDomains.append(`<button type="button" onclick="changeSubDomain('${DATA._id}')" class="btn btn-success waves-effect waves-light mt-3">Url manzil qo'shish</button>`)
        });
    }
    const changeSubDomain = (id) => {
        const leadUrl = document.getElementById('input-repeat').value
        if (leadUrl == "") {
            warning("Malumotni to'liq kiriting")
        }
        else {
            axios({
                url: `/api/school/${id}`,
                method: "PUT",
                data: {
                    subDomain: leadUrl
                }
            })
                .then((res) => {
                    success("Muvaffaqiyatli tahrirlandi")
                    get_active_schools()
                })
        }
    }
    
    
    // function copyUrl(url) {
    //     var copyText = document.getElementById(url);
    //     copyText.select();
    //     copyText.setSelectionRange(0, 99999)
    //     navigator.clipboard.writeText(copyText.value);
    //     success("Lid manzili uchun nusxa olindi")
    // }



</script>